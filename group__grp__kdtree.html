<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="pdltools_extra.css" rel="stylesheet" type="text/css"/>
<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-47128600-1', 'auto');
    ga('send', 'pageview');
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="pdl.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">PDL Tools
   &#160;<span id="projectnumber">1.8</span>
   </div>
   <div id="projectbrief">User Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="gettingstarted.html"><span>Getting&#160;Started</span></a></li>
      <li><a href="installpage.html"><span>Installation</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="changelog.html"><span>Change&#160;Log</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">kd_tree<div class="ingroups"><a class="el" href="group__grp__kdtree__and__knn.html">KD-tree</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><b>Contents</b> </p><ul>
<li class="level1">
<a href="#kdtree_syntax">Syntax</a> </li>
<li class="level1">
<a href="#kdtree_usage">Usage</a> </li>
<li class="level1">
<a href="#kdtree_example">Example</a> </li>
</ul>
</div><dl class="section user"><dt>About</dt><dd>A KD-tree is a data structure that organizes multi-dimensional data in a binary tree (<a href="https://en.wikipedia.org/wiki/K-d_tree">https://en.wikipedia.org/wiki/K-d_tree</a>). It is widely used for efficient nearest neighbour search in a low dimensional space (<a class="el" href="group__grp__kdtree__knn.html">kdtree_knn</a>). Due to the "curse of dimensionality", the search however becomes less effective as the dimensionality of the space increases (e.g. &gt; 10). This function creates a KD-tree by recursively partitioning the data at the median value along the dimension of maximum variance. Each leaf node of the resulting KD-tree contains no more than a pre-specified number of data points.</dd></dl>
<p><a class="anchor" id="kdtree_syntax"></a></p><dl class="section user"><dt>Syntax</dt><dd><pre class="syntax">
FUNCTION kd_tree(data_tab TEXT, id TEXT, dimension TEXT, val TEXT, subtree_size INT, output_tab TEXT) 
RETURNS VOID;
</pre></dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data_tab</td><td>Table that contains the data. </td></tr>
    <tr><td class="paramname">id</td><td>Name of the column specifying data IDs. </td></tr>
    <tr><td class="paramname">dimension</td><td>Name of the column specifying dimension indices. </td></tr>
    <tr><td class="paramname">val</td><td>Name of the column containing data values. </td></tr>
    <tr><td class="paramname">subtree_size</td><td>The desired number of data assigned to each leaf node. </td></tr>
    <tr><td class="paramname">output_tab</td><td>Name of the output table.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__grp__kdtree__knn.html" title="K-nearest neighbour search with KD-tree. ">kdtree_knn</a> for k-nearest neighbour search with KD-tree.</dd></dl>
<p><a class="anchor" id="kdtree_usage"></a></p><dl class="section user"><dt>Usage</dt><dd></dd></dl>
<p>The data is expected to be provided in a table of the following structure: <br />
</p><div class="fragment"><div class="line">TABLE/VIEW data_table</div>
<div class="line">(</div>
<div class="line">    ...</div>
<div class="line">    data_id INT,    -- Data ID</div>
<div class="line">    dimension INT,  -- Dimension index</div>
<div class="line">    val FLOAT8,     -- Data value</div>
<div class="line">    ...</div>
<div class="line">)</div>
</div><!-- fragment --><p>The function accepts sparse data, i.e., zero entries do not need to be present in the data table.</p>
<p>The constructed KD-tree is specified in the output table. It provides information about each node of the tree in the following columns:</p>
<ul>
<li>node_location: An array of 0s and 1s that specifies the location of a node. The ith element of the array indicates whether to go via the left (0) or the right branch (1) at the ith level of the tree in order to reach the current node. Set to NULL for the root node.</li>
<li>split_dimension: Index of the dimension, along which the data in the current node is further split. The splitting dimension is chosen to be the dimension of maximum variance. Set to NULL for leaf nodes.</li>
<li>split_value: Median of the data in the current node along the splitting dimension. In case of even number of data, take the min of the two middle values. Set to NULL for leaf nodes.</li>
<li>pop_variance: Population variance of the data in the current node along the splitting dimension. Set to NULL for leaf nodes.</li>
<li>leaf_member: IDs of the data in the leaf node. Set to NULL for non-leaf nodes.</li>
</ul>
<p><a class="anchor" id="kdtree_example"></a></p><dl class="section user"><dt>Examples</dt><dd></dd></dl>
<ol type="1">
<li>Create a test dataset of 10 2D data points. Note: The function accepts sparse representation of the data. For example, the first input: (1,1,0), in the example below can be removed without affecting the result. <div class="fragment"><div class="line">CREATE TABLE kdtree_test_data (<span class="keywordtype">id</span> INT, dimension INT, val FLOAT8) DISTRIBUTED RANDOMLY;</div>
<div class="line">INSERT INTO kdtree_test_data VALUES</div>
<div class="line">(1, 1, 0),  </div>
<div class="line">(1, 2, 1),</div>
<div class="line">(2, 1, 2),</div>
<div class="line">(2, 2, 2),</div>
<div class="line">(3, 1, 3),</div>
<div class="line">(3, 2, 6),</div>
<div class="line">(4, 1, 4),</div>
<div class="line">(4, 2, 9),</div>
<div class="line">(5, 1, 5),</div>
<div class="line">(5, 2, 7),</div>
<div class="line">(6, 1, 6),</div>
<div class="line">(6, 2, 2),</div>
<div class="line">(7, 1, 7),</div>
<div class="line">(7, 2, 3),</div>
<div class="line">(8, 1, 8),</div>
<div class="line">(8, 2, 4),</div>
<div class="line">(9, 1, 9),</div>
<div class="line">(9, 2, 7),</div>
<div class="line">(10, 1, 10),</div>
<div class="line">(10, 2, 8);</div>
</div><!-- fragment --> <br />
</li>
<li>Construct a KD-tree with each leaf node containing no more than 3 data points. <div class="fragment"><div class="line">SELECT pdltools.kd_tree(<span class="stringliteral">&#39;kdtree_test_data&#39;</span>, <span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;dimension&#39;</span>, <span class="stringliteral">&#39;val&#39;</span>, 3, <span class="stringliteral">&#39;kdtree_test_output&#39;</span>); </div>
<div class="line"></div>
<div class="line">SELECT * FROM kdtree_test_output ORDER BY node_location;</div>
<div class="line"></div>
<div class="line"> node_location | split_dimension | split_value | pop_variance | leaf_member </div>
<div class="line">---------------+-----------------+-------------+--------------+-------------</div>
<div class="line"> {0}           |               2 |           6 |          9.2 | </div>
<div class="line"> {0,0}         |                 |             |              | {1,2,3}</div>
<div class="line"> {0,1}         |                 |             |              | {4,5}</div>
<div class="line"> {1}           |               2 |           4 |         5.36 | </div>
<div class="line"> {1,0}         |                 |             |              | {6,7,8}</div>
<div class="line"> {1,1}         |                 |             |              | {9,10}</div>
<div class="line">               |               1 |           5 |         9.24 | </div>
</div><!-- fragment --> <br />
</li>
<li>Find the 2-nearest neighbours for point (3.5,4); see <a class="el" href="group__grp__kdtree__knn.html">kdtree_knn</a> for the usage of the <a class="el" href="kd__tree_8sql__in.html#a1eb360a69c89b41621ae23de1805b0b5" title="Nearest neighbour search with KD-tree for one query point. ">kdtree_knn()</a> function. <div class="fragment"><div class="line">SELECT * FROM pdltools.kdtree_knn(<span class="stringliteral">&#39;kdtree_test_data&#39;</span>, <span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;dimension&#39;</span>, <span class="stringliteral">&#39;val&#39;</span>, <span class="stringliteral">&#39;kdtree_test_output&#39;</span>, array[3.5,4], 2);</div>
<div class="line"></div>
<div class="line"> knn_id |        knn_dist        </div>
<div class="line">--------+------------------------</div>
<div class="line"> {3,2}  | {2.06155281280883,2.5}</div>
</div><!-- fragment --></li>
</ol>
<p>The <em>knn_id</em> field shows the IDs of the 2-nearest neighbours; the <em>knn_dist</em> field provides the corresponding Euclidean distance from the query point to its nearest neighbours. One can also query the k-nearest neighbours of a set of data as follows:</p>
<div class="fragment"><div class="line">CREATE TABLE query_data (query_id INT, query_point FLOAT8[]) DISTRIBUTED RANDOMLY;</div>
<div class="line">INSERT INTO query_data VALUES</div>
<div class="line">(1, array[8,1]), </div>
<div class="line">(2, array[3,4]),</div>
<div class="line">(3, array[1,2.5]);</div>
<div class="line"></div>
<div class="line">SELECT pdltools.kdtree_knn(<span class="stringliteral">&#39;kdtree_test_data&#39;</span>, <span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;dimension&#39;</span>, <span class="stringliteral">&#39;val&#39;</span>, <span class="stringliteral">&#39;kdtree_test_output&#39;</span>,<span class="stringliteral">&#39;query_data&#39;</span>, <span class="stringliteral">&#39;query_id&#39;</span>, <span class="stringliteral">&#39;query_point&#39;</span>, 2, <span class="stringliteral">&#39;query_result&#39;</span>);</div>
<div class="line"></div>
<div class="line">SELECT * FROM query_result ORDER BY query_id;</div>
<div class="line"></div>
<div class="line"> query_id | knn_id |              knn_dist               </div>
<div class="line">----------+--------+-------------------------------------</div>
<div class="line">        1 | {6,7}  | {2.23606797749979,2.23606797749979}</div>
<div class="line">        2 | {3,2}  | {2,2.23606797749979}</div>
<div class="line">        3 | {2,1}  | {1.11803398874989,1.80277563773199}</div>
</div><!-- fragment --><p>The above <em>query_data</em> table contains IDs of the query points: <em>query_id</em>, and their coordinates: <em>query_point</em>. The k-nearest neighbours (2 in the above example) is given in the <em>query_result</em> table. See the two versions of the <a class="el" href="kd__tree_8sql__in.html#a1eb360a69c89b41621ae23de1805b0b5" title="Nearest neighbour search with KD-tree for one query point. ">kdtree_knn()</a> function (<a class="el" href="group__grp__kdtree__knn.html">kdtree_knn</a>) for more details. </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.nl/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
