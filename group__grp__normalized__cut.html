<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="pdltools_extra.css" rel="stylesheet" type="text/css"/>
<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-47128600-1', 'auto');
    ga('send', 'pageview');
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="pdl.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">PDL Tools
   &#160;<span id="projectnumber">1.8</span>
   </div>
   <div id="projectbrief">User Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="gettingstarted.html"><span>Getting&#160;Started</span></a></li>
      <li><a href="installpage.html"><span>Installation</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="changelog.html"><span>Change&#160;Log</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">normalized_cut<div class="ingroups"><a class="el" href="group__grp__normalized__cut__alg.html">Normalized Cut</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><b>Contents</b> </p><ul>
<li class="level1">
<a href="#normalized_cut_syntax">Syntax</a> </li>
<li class="level1">
<a href="#normalized_cut_usage">Usage</a> </li>
<li class="level1">
<a href="#normalized_cut_example">Example</a> </li>
<li class="level1">
<p class="startli"><a href="#normalized_cut_background">Background</a></p>
<p class="endli"></p>
</li>
</ul>
</div><dl class="section user"><dt>About</dt><dd>The module implements the normalized cut algorithm (<a href="https://people.eecs.berkeley.edu/~malik/papers/SM-ncut.pdf">https://people.eecs.berkeley.edu/~malik/papers/SM-ncut.pdf</a>). It cuts a graph into two disjoint sets by removing edges connecting the two sets. The optimal cut is obtained by minimizing the normalized cut disassociation measure (see the above paper for technical details). This module partitions a graph iteratively until the size of each subgraph reaches a user specified threshold.</dd></dl>
<p><a class="anchor" id="normalized_cut_syntax"></a></p><dl class="section user"><dt>Syntax</dt><dd><pre class="syntax">
FUNCTION normalized_cut(
    similarity_tab TEXT, 
    row_id TEXT, 
    col_id TEXT, 
    val TEXT, 
    max_graph_size INT, 
    output_tab TEXT
    )
RETURNS VOID;
</pre></dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">similarity_tab</td><td>Table that contains nonzero entries of a symmetric matrix with each entry being the similarity between two nodes. The diagonal entries are expected to be strictly positive. </td></tr>
    <tr><td class="paramname">row_id</td><td>Row index column in the similarity table. </td></tr>
    <tr><td class="paramname">col_id</td><td>Column index column in the similarity table. </td></tr>
    <tr><td class="paramname">val</td><td>Value column in the similarity table. </td></tr>
    <tr><td class="paramname">output_tab</td><td>Table that contains node partitions.</td></tr>
  </table>
  </dd>
</dl>
<p><a class="anchor" id="normalized_cut_usage"></a></p><dl class="section user"><dt>Usage</dt><dd></dd></dl>
<p>The input similarity matrix is expected to be symmetric and contain non-negative values. It should be provided in a table of the following structure: <br />
</p><div class="fragment"><div class="line">TABLE/VIEW similarity_tab</div>
<div class="line">(</div>
<div class="line">    ...</div>
<div class="line">    row_id TEXT/INT/BIGINT,     -- Row index</div>
<div class="line">    col_id TEXT/INT/BIGINT,     -- Column index</div>
<div class="line">    val    FLOAT8               -- Similarity value</div>
<div class="line">    ...</div>
<div class="line">)</div>
</div><!-- fragment --><p>Zero entries need not be provided in the similarity table. Entries on the diagonal are expected to be strictly positive. A commonly used similarity measure is Gaussian similarity: \(W_{ij} = exp(-||x_i - x_j||^2/\sigma^2)\), where \(x_i\) and \(x_j\) are feature vectors associated with node \(i\) and node \(j\).</p>
<p>Node partitions are provided in the user-specified output table: </p><div class="fragment"><div class="line">TABLE/VIEW output_tab</div>
<div class="line">(</div>
<div class="line">    partition_label TEXT, -- Partition label indicating which partition a node belongs to</div>
<div class="line">    node            TEXT  -- Node ID, given by the row indices in the similarity table</div>
<div class="line">)</div>
</div><!-- fragment --><p><a class="anchor" id="normalized_cut_example"></a></p><dl class="section user"><dt>Examples</dt><dd></dd></dl>
<ol type="1">
<li>Create test points/nodes. <div class="fragment"><div class="line">CREATE TEMP TABLE ncut_test_data (node INT, feature FLOAT[]) DISTRIBUTED RANDOMLY;</div>
<div class="line">INSERT INTO ncut_test_data VALUES</div>
<div class="line">(1,ARRAY[0.00513649,0.167166]),</div>
<div class="line">(2,ARRAY[0.44311,0.127502]),</div>
<div class="line">(3,ARRAY[0.312811,0.421223]),</div>
<div class="line">(4,ARRAY[0.373044,0.280389]),</div>
<div class="line">(5,ARRAY[0.166491,0.123695]),</div>
<div class="line">(6,ARRAY[1.04216,1.21863]),</div>
<div class="line">(7,ARRAY[1.06422,1.42166]),</div>
<div class="line">(8,ARRAY[1.19542,1.44384]),</div>
<div class="line">(9,ARRAY[1.01775,1.25931]),</div>
<div class="line">(10,ARRAY[2.81904,3.3038]),</div>
<div class="line">(11,ARRAY[3.08253,3.2119]),</div>
<div class="line">(12,ARRAY[3.232,3.11088]),</div>
<div class="line">(13,ARRAY[3.00462,3.19002]),</div>
<div class="line">(14,ARRAY[2.95855,2.83753]),</div>
<div class="line">(15,ARRAY[3.24319,2.85697]);</div>
</div><!-- fragment --> <br />
</li>
<li>Calculate pairwise similarity, i.e., edge weights. Zero weight is given to edges connecting two nodes with their similarity &lt; 2e-3. The similarity matrix is therefore generally sparse. <div class="fragment"><div class="line">CREATE TEMP TABLE ncut_test_sim AS</div>
<div class="line">(</div>
<div class="line">    WITH a AS (</div>
<div class="line">        SELECT a.node row_id, </div>
<div class="line">            b.node col_id,  </div>
<div class="line">            <a class="code" href="complex__type_8sql__in.html#a864d89c825b5bed581dafb7383b38325">exp</a>(-madlib.dist_norm2(a.feature, b.feature)/0.5) similarity</div>
<div class="line">        FROM ncut_test_data a, ncut_test_data b</div>
<div class="line">    )</div>
<div class="line">    SELECT * FROM a WHERE similarity &gt;= 2e-3</div>
<div class="line">) DISTRIBUTED RANDOMLY;</div>
</div><!-- fragment --> <br />
</li>
<li>Use normalized cut to iteratively partition the graph until each subgraph has no more than 6 nodes. <div class="fragment"><div class="line">SELECT pdltools.normalized_cut(</div>
<div class="line">    <span class="stringliteral">&#39;ncut_test_sim&#39;</span>,    -- Sparse pairwise similarity table</div>
<div class="line">    <span class="stringliteral">&#39;row_id&#39;</span>,           -- Row index column</div>
<div class="line">    <span class="stringliteral">&#39;col_id&#39;</span>,           -- Column index column</div>
<div class="line">    <span class="stringliteral">&#39;similarity&#39;</span>,       -- Similarity column</div>
<div class="line">    6,                  -- Maximum subgraph size</div>
<div class="line">    <span class="stringliteral">&#39;ncut_test_output&#39;</span>  -- Output table</div>
<div class="line">    );</div>
<div class="line"></div>
<div class="line">SELECT * FROM ncut_test_output ORDER BY partition_label, node;</div>
<div class="line"></div>
<div class="line"> partition_label | node </div>
<div class="line">-----------------+------</div>
<div class="line"> 0               | 10</div>
<div class="line"> 0               | 11</div>
<div class="line"> 0               | 12</div>
<div class="line"> 0               | 13</div>
<div class="line"> 0               | 14</div>
<div class="line"> 0               | 15</div>
<div class="line"> 10              | 6</div>
<div class="line"> 10              | 7</div>
<div class="line"> 10              | 8</div>
<div class="line"> 10              | 9</div>
<div class="line"> 11              | 1</div>
<div class="line"> 11              | 2</div>
<div class="line"> 11              | 3</div>
<div class="line"> 11              | 4</div>
<div class="line"> 11              | 5</div>
</div><!-- fragment --></li>
</ol>
<p><a class="anchor" id="normalized_cut_background"></a></p><dl class="section user"><dt>Technical Background</dt><dd></dd></dl>
<p>Given a symmetric similarity matrix \(W\) of a connected graph (graph without isolated connected components), the standard implementation of normalized cut solves the eigenvalue system: \((D-W)x = \lambda D x\), where \(D\) is a diagonal matrix whose ith diagonal entry is the sum of the ith row of \(W\). The eigenvector corresponding to the second smallest eigenvalue is used to partition the graph. Thresholding eigenvector entries at 0 partitions nodes into two groups. For graphs with \(k&gt;1\) connected components, the first \(k\) eigenvectors indicate the node membership to each connected component; see Page 15 of the tutorial: <a href="https://www.cs.cmu.edu/~aarti/Class/10701/slides/Lecture21_2.pdf">https://www.cs.cmu.edu/~aarti/Class/10701/slides/Lecture21_2.pdf</a> for more details.</p>
<p>The general eigenvalue system: \((D-W)x = \lambda D x\) can be transformed to a standard eigenvector problem: \(D^{-1/2}WD^{-1/2}x = (1-\lambda)x\). The eigenvector with the second smallest eigenvalue of the original system is the eigenvector with the second largest eigenvalue of the transformed eigenvector problem. For computation efficiency, we further transform the eigenvector problem to a singular value decomposition problem. We first shift \(D^{-1/2}WD^{-1/2}\) by a scaled identity matrix ( \(10I\) used in the implementation) to ensure matrix non-negativity. In theory, adding \(I\) is sufficient for that purpose. Note that the addition of the scaled identity matrix only shifts eigenvalues, but does not change eigenvectors. Since the shifted matrix is symmetric non-negative, the left (or right) singular vectors of \(aI + D^{-1/2}WD^{-1/2}\) with \(a&gt;=1\) are also eigenvectors of \(D^{-1/2}WD^{-1/2}\). In the implementation, we use the irlba package in R (<a href="https://cran.r-project.org/package=irlba">https://cran.r-project.org/package=irlba</a>) for efficient singular vector approximation for large sparse matrices. </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.nl/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
