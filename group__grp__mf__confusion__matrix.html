<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="pdltools_extra.css" rel="stylesheet" type="text/css"/>
<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-47128600-1', 'auto');
    ga('send', 'pageview');
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="pdl.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">PDL Tools
   &#160;<span id="projectnumber">1.8</span>
   </div>
   <div id="projectbrief">User Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="gettingstarted.html"><span>Getting&#160;Started</span></a></li>
      <li><a href="installpage.html"><span>Installation</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="changelog.html"><span>Change&#160;Log</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">mf_confusion_matrix<div class="ingroups"><a class="el" href="group__grp__prediction__metrics.html">Prediction Metrics</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><b>Contents</b> </p><ul>
<li class="level1">
<a href="#mf_confusion_matrix_syntax">Syntax</a> </li>
<li class="level1">
<a href="#mf_confusion_matrix_linkage_usage">Usage</a> </li>
<li class="level1">
<a href="#mf_confusion_matrix_example">Example</a> </li>
</ul>
</div><dl class="section user"><dt>About</dt><dd>A function calculating the confusion matrix, for use in multi-class classification.</dd></dl>
<p><a class="anchor" id="mf_confusion_matrix_syntax"></a></p><dl class="section user"><dt>Syntax</dt><dd><pre class="syntax">
FUNCTION mf_confusion_matrix(
                              in_table TEXT,
                              prediction_col TEXT, observed_col TEXT,
                              out_table TEXT)
RETURNS VOID
</pre></dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">in_table</td><td>Name of the input table. </td></tr>
    <tr><td class="paramname">prediction_col</td><td>Name of the column of predicted values. </td></tr>
    <tr><td class="paramname">observed_col</td><td>Name of the column of observed values. </td></tr>
    <tr><td class="paramname">out_table</td><td>Name of the output table.</td></tr>
  </table>
  </dd>
</dl>
<p><a class="anchor" id="mf_confusion_matrix_usage"></a></p><dl class="section user"><dt>Usage</dt><dd>In multi-class classification, observations and predictions are taken from some finite set. Elements of this set may be encoded in any form, e.g. as numbers or strings. Each element is known as a 'class'. A confusion matrix, which is the output of this function, details for each <code>'x'</code> and <code>'y'</code>, how many times in the data given in <em>'in_table'</em>, a prediction of <code>'x'</code> corresponded to an observed actual value of <code>'y'</code>. The function can perform this regardless of the type of data in the prediction and observed columns, but this type should be the same in both.</dd></dl>
<p>The output is a table with two columns:</p><ul>
<li><em>'class'</em> - The observed class.</li>
<li><em>'confusion_arr'</em> - an array of integers, each integer corresponding to the number of times a particular predicted value corresponded to the observed class. The array is ordered by the predicted value.</li>
</ul>
<p>The <em>'confusion_arr'</em> rows, when ordered by the observed class, form a square matrix whose diagonal corresponds to 'correct' classifications. The matrix includes rows (and columns) for each class represented in <em>'in_table'</em>, whether it was seen as an observed or as a predicted class.</p>
<p><a class="anchor" id="mf_confusion_matrix_example"></a></p><dl class="section user"><dt>Examples</dt><dd>Assume we have trained a model and used it to perform multi-class classification on certain values of the independent parameters. (In the example, these values are taken to be from a "test_set", implying that they are distinct from those values on which the model was trained. However, in real usage the function may be used also on the training set, although the interpretation of the results will be different.) In parallel, for each set of values of the independent parameters we also have the ground truth, e.g. an observed value.</dd></dl>
<p>In the example, the classes are the numbers 0 through 5. However, to demonstrate how the UDF functions when there is incomplete overlap between predicted and observed values, we will only use 1 through 5 for predictions and only use 0 through 4 for observed values.</p>
<p>We place the predicted and observed values into the "pred" and "obs" columns of the "test_set" table, respectively.</p>
<p>For the example, we will create the following dummy test_set table:</p>
<div class="fragment"><div class="line">user=$ CREATE TABLE test_set AS</div>
<div class="line">user-$   SELECT (x+y)%5+1 AS pred,</div>
<div class="line">user-$          (x*y)%5 AS obs</div>
<div class="line">user-$    FROM generate_series(1,5) x,</div>
<div class="line">user-$         generate_series(1,5) y</div>
<div class="line">user-$ DISTRIBUTED RANDOMLY;</div>
</div><!-- fragment --><p>The confusion matrix is generated as follows.</p>
<div class="fragment"><div class="line">user=# SELECT <a class="code" href="prediction__metrics_8sql__in.html#a498700e8b6b743acb6df40ae3fe7e490">mf_confusion_matrix</a>(<span class="stringliteral">&#39;test_set&#39;</span>,<span class="stringliteral">&#39;pred&#39;</span>,<span class="stringliteral">&#39;obs&#39;</span>,<span class="stringliteral">&#39;out_table&#39;</span>);</div>
<div class="line"> <a class="code" href="prediction__metrics_8sql__in.html#a498700e8b6b743acb6df40ae3fe7e490">mf_confusion_matrix</a> </div>
<div class="line">---------------------</div>
<div class="line"> </div>
<div class="line">(1 row)</div>
<div class="line"></div>
<div class="line">michaeldb=# SELECT * FROM out_table ORDER BY <span class="keyword">class</span>;</div>
<div class="line"> <span class="keyword">class </span>| confusion_arr </div>
<div class="line">-------+---------------</div>
<div class="line">     0 | {0,1,2,2,2,2}</div>
<div class="line">     1 | {0,2,0,1,1,0}</div>
<div class="line">     2 | {0,0,0,2,2,0}</div>
<div class="line">     3 | {0,0,2,0,0,2}</div>
<div class="line">     4 | {0,2,1,0,0,1}</div>
<div class="line">     5 | {0,0,0,0,0,0}</div>
<div class="line">(6 rows)</div>
</div><!-- fragment --><p>As can be seen, the generated matrix contains rows and columns for all values between 0 and 5, even though some were never seen as observed classes and others were never seen as predicted classes. </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.nl/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
